import guigen;
import ecore;
extension template::GenericExtensions;

///////////////////////////////////////////////////////////////////////////////////////////////
/// Estensioni specifiche per il framework Struts2                                           //
///////////////////////////////////////////////////////////////////////////////////////////////


String getPresentationJavaSrcDir(GUIModel model, boolean omit_root) :
	getBaseJavaSrcDir(model, omit_root) + "/presentation/" + model.codComponente + "/action";

String getPresentationJavaPackage(GUIModel model) :
	getBaseJavaPackage(model) + ".presentation." + model.codComponente + ".action";

String getPresentationMarkupDir(GUIModel model, boolean omit_root) :
	getWebSrcDir(model, omit_root) + "/jsp";
	
String getPresentationMarkupConfig() :
	"jsp";	

String getPresentationJavaPath(GUIModel model) :
	getBaseJavaPath(model) + "/presentation/" + model.codComponente + "/action";

String getValidationJavaSrcDir(GUIModel model, boolean omit_root) :
	getBaseJavaSrcDir(model, omit_root) + "/presentation/" + model.codComponente + "/validator";

String getValidationJavaPackage(GUIModel model) :
	getBaseJavaPackage(model) + ".presentation." + model.codComponente + ".validator";

String getFiltersJavaSrcDir(GUIModel model, boolean omit_root) :
	getBaseJavaSrcDir(model, omit_root) + "/presentation/" + model.codComponente + "/filter";

String getFiltersJavaPackage(GUIModel model) :
	getBaseJavaPackage(model) + ".presentation." + model.codComponente + ".filter";

String getSecurityJavaSrcDir(GUIModel model, boolean omit_root) :
	getBaseJavaSrcDir(model, omit_root) + "/presentation/" + model.codComponente + "/security";

String getSecurityJavaPackage(GUIModel model) :
	getBaseJavaPackage(model) + ".presentation." + model.codComponente + ".security";
		
///////////////////////////////////////////////////////////////////////////////////////////////
/// Files di configurazione di Struts2

String getStrutsConfigFile(GUIModel model, boolean omit_root) :
	getWebModuleConfigDir(model, omit_root) + "/struts.xml";

String getStrutsGlobalConfigFile(GUIModel model, boolean omit_root) :
	getWebModuleConfigDir(model, omit_root) + "/struts-global.xml";

String getStrutsApplicationConfigFile(GUIModel model, boolean omit_root, String fileName) :
	getWebModuleConfigDir(model, omit_root) + "/" + fileName + ".xml";

String getStrutsValidationConfigFile(GUIModel model, boolean omit_root) :
	getWebModuleConfigDir(model, omit_root) + "/validators.xml";

String getStrutsGlobalMessagesPropertiesFile(GUIModel model, boolean omit_root) :
	getWebModuleConfigDir(model, omit_root) + "/globalMessages.properties";


///////////////////////////////////////////////////////////////////////////////////////////////
/// Files di configurazione di Spring

String getSpringEjbConfigurationFile(GUIModel model, boolean omit_root) :
	getEjbConfigDir(model, omit_root) + "/beanContext.xml";
	
String getSpringWebConfigurationFile(GUIModel model, boolean omit_root) :
	getWebModuleConfigDir(model, omit_root) + "/applicationContext.xml";


///////////////////////////////////////////////////////////////////////////////////////////////
/// Files di configurazione servizi supplier

String getSpringIRIDE2PDConfig(GUIModel model) :
	getEjbConfigDir(model, true) + "/iride2_pep_defPD_ejb.xml";


///////////////////////////////////////////////////////////////////////////////////////////////
/// Build files 

String getReminclResourceProvider(GUIModel model) :
	if ( model.portale == PortalNames::INTRANET_RUPARPIEMONTE ) then
		"http://dev-portale.ruparpiemonte.it"
	else if ( model.portale == PortalNames::SISTEMA_PIEMONTE ) then
		"http://dev-www.sistemapiemonte.it"
	else
		"";

///////////////////////////////////////////////////////////////////////////////////////////////
/// Files JSP comuni

// Index Page (for redirection purpoose only)
String getIndexJspFile(GUIModel model, boolean omit_root) :
	getWebSrcDir(model, omit_root) + "/index.jsp";

// Home Page
String getHomePageConfig(GUIModel model) :
	getStrutsActionJspConfigName(model.structure.appWindow.appArea.contentPanels.first());

// Error pages
String getJspErrorPagesDir(GUIModel model, boolean omit_root) :
	getPresentationMarkupDir(model, omit_root) + "/error";

// JSP Fragments (Header, footer, ecc...)
String getJspFragmentsMarkupDir(GUIModel model, boolean omit_root) :
	getPresentationMarkupDir(model, omit_root) + "/fragments";

// JSP Tab (Tabbed Panels Includes)
String getJspTabsMarkupDir(GUIModel model, boolean omit_root) :
	getPresentationMarkupDir(model, omit_root) + "/tabs";

String getJspTabsConfig() :
	"/" + getPresentationMarkupConfig() + "/tabs";

// Jsp MultiPanel includes
String getJspMultiPanelsMarkupDir(GUIModel model, boolean omit_root) :
	getPresentationMarkupDir(model, omit_root) + "/multipanels";

String getJspMultiPanelsConfig() :
	"/" + getPresentationMarkupConfig() + "/multipanels";

// Jsp WizardPanel includes
String getJspWizardPanelsMarkupDir(GUIModel model, boolean omit_root) :
	getPresentationMarkupDir(model, omit_root) + "/wizardpanels";

String getJspWizardPanelsConfig() :
	"/" + getPresentationMarkupConfig() + "/wizardpanels";

// JSP MultiPanels fragments
String getJspMultiPanelFullName(GUIModel model, boolean omit_root, MultiPanel mp, Panel p) :
	if ( mp.metaType == MultiPanel ) then
		getJspMultiPanelsMarkupDir(model, omit_root) + "/" + mp.name + "_" + p.name + ".jsp"
	else if ( mp.metaType == TabSetPanel ) then
		getJspTabsMarkupDir(model, omit_root) + "/" + mp.name + "_" + p.name + ".jsp"
	else if ( mp.metaType == WizardPanel ) then
		getJspWizardPanelsMarkupDir(model, omit_root) + "/" + mp.name + "_" + p.name + ".jsp";

String getMultiPanelJspInclude(MultiPanel mp, Panel p) :
	if ( mp.metaType == MultiPanel ) then
		getJspMultiPanelsConfig() + "/" + mp.name + "_" + p.name + ".jsp"
	else if ( mp.metaType == TabSetPanel ) then
		getJspTabsConfig() + "/" + mp.name + "_" + p.name + ".jsp"
	else if ( mp.metaType == WizardPanel ) then
		getJspWizardPanelsConfig() + "/" + mp.name + "_" + p.name + ".jsp";

// JSP for UserDefinedPanels
String getJspUserDefinedPanelMarkupDir(GUIModel model, boolean omit_root) :
	getPresentationMarkupDir(model, omit_root) + "/userpanels";

String getJspUserDefinedPanelConfig() :
	"/" + getPresentationMarkupConfig() + "/userpanels";

// JSP for UserDefinedWidget
String getJspUserDefinedWidgetMarkupDir(GUIModel model, boolean omit_root) :
	getPresentationMarkupDir(model, omit_root) + "/userwidgets";

String getJspUserDefinedWidgetConfig() :
	"/" + getPresentationMarkupConfig() + "/userwidgets";


///////////////////////////////////////////////////////////////////////////////////////////////
/// Classi Java comuni

String getDTOBaseJavaPackage(GUIModel model) :
	getBaseJavaPackage(model) + ".dto";

String getDTOBaseSrcDir(GUIModel model) :
	getBaseJavaSrcDir(model, true)+"/dto";

String getDTOClassName(ComplexType ct) :
	ct.name.toFirstUpper();

String getFQNDTOClassName(ComplexType ct, GUIModel model) :
	getDTOBaseJavaPackage(model)+"."+getDTOClassName(ct);
	
String getFullDTOClassFile(ComplexType ct, GUIModel model) :
	getDTOBaseSrcDir(model)+"/"+getDTOClassName(ct)+".java";	

String getModelDTOClassName(ContentPanel cp, boolean forMenu, boolean forHome, GUIModel model) :
    ( forMenu? "GlobalMenuModel":
    	(forHome? "GlobalHomeModel": cp.name.toFirstUpper()+"Model") 
    );

String getModelDTOFQN(ContentPanel cp, boolean forMenu, boolean forHome, GUIModel model) :
	getDTOBaseJavaPackage(model) + "." + getModelDTOClassName(cp, forMenu, forHome, model);

String getFullModelDTOClassFile(ContentPanel cp, boolean forMenu, boolean forHome, GUIModel model) :
	getDTOBaseSrcDir(model)+"/"+getModelDTOClassName(cp, forMenu, forHome, model)+".java";
	 
/// MENU
String getStrutsMenuClassName(GUIModel model) :
	"MenuAction";
	
String getStrutsMenuFQN(GUIModel model) :
	getPresentationJavaPackage(model) + "." + getStrutsMenuClassName(model);

String getStrutsHomeClassName(GUIModel model) :
	"HomeAction";
	
String getStrutsHomeFQN(GUIModel model) :
	getPresentationJavaPackage(model) + "." + getStrutsHomeClassName(model);
	
String getStrutsMenuJavaFile(GUIModel model, boolean omit_root) :
	getPresentationJavaSrcDir(model, omit_root) + "/" + getStrutsMenuClassName(model) + ".java";

String getStrutsHomeJavaFile(GUIModel model, boolean omit_root) :
	getPresentationJavaSrcDir(model, omit_root) + "/" + getStrutsHomeClassName(model) + ".java";

String getStrutsMenuConfigName(GUIModel model) :
	"menuAction";

String getStrutsHomePropertiesFile(GUIModel model, boolean omit_root) :
	getPresentationJavaSrcDir(model, omit_root) + "/" + getStrutsHomeClassName(model) + ".properties";

/// BaseAction
String getStrutsBaseActionClassName(GUIModel model) :
	"BaseAction";

String getStrutsBaseActionFQN(GUIModel model) :
	getPresentationJavaPackage(model) + "." + getStrutsBaseActionClassName(model);

String getStrutsBaseActionJavaFile(GUIModel model, boolean omit_root) :
	getPresentationJavaSrcDir(model, omit_root) + "/" + getStrutsBaseActionClassName(model) + ".java";

String getIrideIdAdapterFilterClassName() :
	"IrideIdAdapterFilter";
	
String getIrideIdAdapterFilterFQN(GUIModel model) :
	getFiltersJavaPackage(model) + "." + getIrideIdAdapterFilterClassName();
	
String getIrideIdAdapterFilterJavaFile(GUIModel model, boolean omit_root) :
	getFiltersJavaSrcDir(model, omit_root) + "/" + getIrideIdAdapterFilterClassName() + ".java";
	
String getIridePDCacheClassName() :
	"IridePDCache";
	
String getIridePDCacheFQN(GUIModel model) :
	getBaseJavaPackage(model) + ".business." + getIridePDCacheClassName();
	
String getIridePDCacheJavaFile(GUIModel model, boolean omit_root) :
	getBaseJavaSrcDir(model, omit_root) + "/business/" + getIridePDCacheClassName() + ".java";


String getTableDecoratorClassName(Table tbl) :
	findParentContentPanel(tbl).name.toFirstUpper()+tbl.name.toFirstUpper()+"CustomDecorator";
	
String getTableDecoratorFQN(GUIModel model, Table tbl) :
	getPresentationJavaPackage(model)+"."+getTableDecoratorClassName(tbl);
	
String getTableDecoratorJavaFile(GUIModel model, Table tbl) :
	getPresentationJavaSrcDir(model, true) + "/" + getTableDecoratorClassName(tbl) + ".java";	
	
/// Pattern Command Actions Classes



///////////////////////////////////////////////////////////////////////////////////////////////
/// Action Struts2

String getStrutsActionClassName(ContentPanel panel) :
	panel.name.toFirstUpper() + "Action";
	
String getStrutsActionJspName(ContentPanel panel) :
	panel.name;

String getStrutsActionConfigName(ContentPanel panel) :
	panel.name;

String getStrutsActionFQN(ContentPanel panel, GUIModel model) :
	getPresentationJavaPackage(model) + "." + getStrutsActionClassName(panel);
	
String getStrutsActionPath(ContentPanel panel, GUIModel model) :
	getPresentationJavaPath(model) + "/" + getStrutsActionClassName(panel);	
	
String getStrutsActionJavaFile(ContentPanel panel, GUIModel model, boolean omit_root) :
	getPresentationJavaSrcDir(model, omit_root) + "/" + getStrutsActionClassName(panel) + ".java";
	
String getStrutsActionJspFile(ContentPanel panel, GUIModel model, boolean omit_root) :
	getPresentationMarkupDir(model, omit_root) + "/" + getStrutsActionJspName(panel) + ".jsp";

String getStrutsActionJspConfigName(ContentPanel panel) :
	"/" + getPresentationMarkupConfig() + "/" + getStrutsActionJspName(panel) + ".jsp";

String getStrutsActionPropertiesFile(ContentPanel panel, GUIModel model, boolean omit_root) :
	getPresentationJavaSrcDir(model, omit_root) + "/" + getStrutsActionClassName(panel) + ".properties";


///////////////////////////////////////////////////////////////////////////////////////////////
/// Validatori e convertitori Struts2

String getStrutsCustomValidatorFQN(String validatorName, GUIModel model) :
	getValidationJavaPackage(model) + "." + validatorName.toFirstUpper();
	
String getStrutsCustomValidatorJavaFile(String validatorName, GUIModel model, boolean omit_root) :
	getValidationJavaSrcDir(model, omit_root) + "/" + validatorName.toFirstUpper() + ".java";


///////////////////////////////////////////////////////////////////////////////////////////////
// Classi spring

String getSpringBEClassName() :
	"BackEndFacade";

String getSpringBEFQN(GUIModel model) :
	getBaseJavaPackage(model)+".business."+getSpringBEClassName();

String getSpringBEJavaFile(GUIModel model) :
	getBaseJavaSrcDir(model, true)+"/business/"+getSpringBEClassName()+".java";

String getSpringCPBEClassName(ContentPanel cp) :
	"CPBE"+cp.name.toFirstUpper();

String getSpringCPBEFQN(GUIModel model, ContentPanel cp) :
	getBaseJavaPackage(model)+".business."+getSpringCPBEClassName(cp);

String getSpringCPBEJavaFile(GUIModel model, ContentPanel cp) :
	getBaseJavaSrcDir(model, true)+"/business/"+getSpringCPBEClassName(cp)+".java";



String getSpringBEExcClassName() :
	"BEException";

String getSpringBEExcFQN(GUIModel model) :
	getBaseJavaPackage(model)+".business."+getSpringBEExcClassName();

String getSpringBEExcJavaFile(GUIModel model) :
	getBaseJavaSrcDir(model, true)+"/business/"+getSpringBEExcClassName()+".java";

String getSpringSecurityHelperClassName() :
	"SecurityHelper";

String getSpringSecurityHelperFQN(GUIModel model) :
	getBaseJavaPackage(model)+".business."+getSpringSecurityHelperClassName();

String getSpringSecurityHelperJavaFile(GUIModel model) :
	getBaseJavaSrcDir(model, true)+"/business/"+getSpringSecurityHelperClassName()+".java";


///////////////////////////////////////////////////////////////////////////////////////////////
/// Type Mapping

/// mapping di tipi model -> java
String toJavaSimpleType(Type type) :
	let code = ((SimpleType)type).code :
	let nillable =  ((SimpleType)type).nillable :
	if (code == guigen::SimpleTypeCodes::INT) then
  	(nillable ? "java.lang.Integer" : "int")
	else if (code == guigen::SimpleTypeCodes::STRING) then
  	(nillable ? "java.lang.String" : "java.lang.String")
	else if (code == guigen::SimpleTypeCodes::FLOAT) then
  	(nillable ? "java.lang.Float" : "float")
  	else if (code == guigen::SimpleTypeCodes::LONG) then
  	(nillable ? "java.lang.Long" : "long")
	else if (code == guigen::SimpleTypeCodes::DOUBLE) then
  	(nillable ? "java.lang.Double" : "double")
	else if (code == guigen::SimpleTypeCodes::BOOLEAN) then
  	(nillable ? "java.lang.Boolean" : "boolean")
	else if (code == guigen::SimpleTypeCodes::DATE) then
  	(nillable ? "java.lang.String" : "java.lang.String")
  	else if (code == guigen::SimpleTypeCodes::DATETIME) then
  	(nillable ? "java.lang.String" : "java.lang.String")
  	else if (code == guigen::SimpleTypeCodes::HOURS) then
  	(nillable ? "java.lang.String" : "java.lang.String")
	else if (code == guigen::SimpleTypeCodes::BYTE) then
  	(nillable ? "byte" : "byte")
  	else if (code == guigen::SimpleTypeCodes::TREE_NODE) then
  		"it.csi.custom.component.tree.base.TreeNode"
	else 
  	"???";

String toJavaType(Type type, GUIModel model) :
if (type==null) then
	"void"
else if (type.metaType==SimpleType) then
	toJavaSimpleType(type)
else if (type.metaType==ComplexType) then
      getDTOBaseJavaPackage(model)+"."+type.name.toFirstUpper() 
else 
	"java.util.ArrayList<"+toJavaType(((TypedArray)type).componentType, model)+">";

String defaultInitVal(Type type, GUIModel model) :
	if(type==null) then
	  "null"
	else if(type.metaType==SimpleType) then
	  defaultSimpleInitVal(type)
	else if(type.metaType==TypedArray) then
	  "new java.util.ArrayList<"+toJavaType(((TypedArray)type).componentType, model)+">()"
	else
	  "null";

String defaultSimpleInitVal(Type type) :
let code = ((SimpleType)type).code :
	let nillable =  ((SimpleType)type).nillable :
	if (code == guigen::SimpleTypeCodes::INT) then
  	(nillable ? "null" : "0")
	else if (code == guigen::SimpleTypeCodes::STRING) then
  	(nillable ? "null" : "null")
	else if (code == guigen::SimpleTypeCodes::FLOAT) then
  	(nillable ? "null" : "0")
  	else if (code == guigen::SimpleTypeCodes::LONG) then
  	(nillable ? "null" : "0")
	else if (code == guigen::SimpleTypeCodes::DOUBLE) then
  	(nillable ? "null" : "0")
	else if (code == guigen::SimpleTypeCodes::BOOLEAN) then
  	(nillable ? "null" : "true")
	else if (code == guigen::SimpleTypeCodes::DATE) then
  	(nillable ? "null" : "null")
  	else if (code == guigen::SimpleTypeCodes::DATETIME) then
  	(nillable ? "null" : "null")
  	else if (code == guigen::SimpleTypeCodes::HOURS) then
  	(nillable ? "null" : "null")
	else if (code == guigen::SimpleTypeCodes::BYTE) then
  	(nillable ? "0" : "0")
	else 
  	"???";



///////////////////////////////////////////////////////////////////////////////////////////////
/// EVENT HANDLERS

String getHandlerMethodName(Widget source, EventHandler evh) :
	"handle"+source.name.toFirstUpper()+"_"+evh.eventType.toString();

String getClickHandlerMethodName(Widget source) :
	( source.eventHandlers.select(eh|eh.eventType==EventTypes::CLICKED).size==1 ? 
		getHandlerMethodName(source, source.eventHandlers.select(eh|eh.eventType==EventTypes::CLICKED).first())
		:
		"execute" 
	);

// [DM] genera il codice che gestise l'evento change sulla combobox con JavaScript abilitato (bisogna includere il file pulsantiPadreFiglio.js)
String getComboBoxValueChangedHandlerJS(ComboBox cb) :
	if ( cb.eventHandlers.select(eh|eh.eventType==EventTypes::VALUE_CHANGED).size==1 ) then
		"onclick=\"onCBClick(this,'conferma" + cb.name + "','conferma','" + getStrutsActionConfigName(findParentContentPanel(cb)) + "!" + getHandlerMethodName(cb,cb.eventHandlers.select(eh|eh.eventType==EventTypes::VALUE_CHANGED).first()) + ".do')\"" + 
		"onfocus=\"inFocus(this)\"" +
		"onblur=\"lostFocus(this,'conferma" + cb.name + "','conferma','" + getStrutsActionConfigName(findParentContentPanel(cb)) + "!" + getHandlerMethodName(cb,cb.eventHandlers.select(eh|eh.eventType==EventTypes::VALUE_CHANGED).first()) + ".do')\"";

// [DM] genera il codice che gestise l'evento change sulla combobox (con JavaScript disabilitato)
String getComboBoxValueChangedHandlerNoScript(ComboBox cb, GUIModel model) :
	if ( cb.eventHandlers.select(eh|eh.eventType==EventTypes::VALUE_CHANGED).size==1 ) then
		"<noscript><s:submit value=\"conferma\" name=\"conferma" + cb.name + "\" id=\"conferma" + cb.name + "\" cssStyle=\"" + 
			getComboBoxValueChangedHandlerStyle(model) + "\" method=\"" + getHandlerMethodName(cb,cb.eventHandlers.select(eh|eh.eventType==EventTypes::VALUE_CHANGED).first()) + 
			"\" /></noscript>";

// [DM] restituisce l'azione relativa ad una colonna della tabella
String getColumnAction(Column currCol, Table table, ContentPanel cp) : 
	if (currCol.eventActive) then
		"href=\"" + getStrutsActionConfigName(cp) + "!" + getHandlerMethodName(table,table.eventHandlers.select(eh|eh.eventType==EventTypes::CLICKED).first()) + 
			".do?idColonna=" + currCol.selector + "\" paramId=\"idRiga\" paramProperty=\"" + table.columnModel.valueSelector + "\"";


///////////////////////////////////////////////////////////////////////////////////////////////
/// PORTAL THEMES AND STYLES

String getStrutsThemeByPortal(GUIModel model) :
	if ( model.portale == guigen::PortalNames::INTRANET_RUPARPIEMONTE ) then
		"csi" //"csirupar"
	else if ( model.portale == guigen::PortalNames::SISTEMA_PIEMONTE ) then
		"csi" //"csisisp"
	else
		"csi";

String getTablePortalStyle(GUIModel model) :
	if ( model.portale == guigen::PortalNames::INTRANET_RUPARPIEMONTE ) then
		"class=\"righe_alternate\"  cellpadding=\"0\" cellspacing=\"0\""
	else if ( model.portale == guigen::PortalNames::SISTEMA_PIEMONTE ) then
		"class=\"col\" cellpadding=\"2\" cellspacing=\"2\""
	else
		"class=\"\" cellpadding=\"2\" cellspacing=\"2\"";


//------------------------------------------- RUPAR -------------------------------------------

String getMenuItemCssRupar(MenuItem item, int level) :
	if (level == 1) then
		"class=\"<s:property value=\"%{#session.active_menu == 'menu_items_"+item.name+"' ? 'on' : ''}\" />\""
	else
		"";

String getMenuItemLabelRupar(MenuItem item, int level) :
	//TODO: implementare correttamente
	"<s:text name=\"" + item.name + ".label\" />";

String getMenuCssRupar(Menu menu, int level, boolean actionActive) :
	//TODO: implementare correttamente
	"";

String getMenuLinkCssRupar(Menu menu, int level) :
	//TODO: implementare correttamente
	"";

String getMenuLabelRupar(Menu menu, int level) :
	//TODO: implementare correttamente
	"<s:text name=\"" + menu.name + ".label\" />";


//------------------------------------- SISTEMA PIEMONTE --------------------------------------

String getMenuItemCssSistemaPiemonte(MenuItem item, int level, boolean isActive) :
	if (level == 1) then
		(isActive ? "class=\"attivo\"" : "")
	else if (level == 2) then
		(isActive ? "class=\"attivo\"" : "")
	//else if (level == 3) then
	//	(isActive ? "class=\"attivo3liv\"" : "")
	//else if(level == 4) then
	//	(isActive ? "class=\"attivo4liv\"" : "")
	else
		"";

String getMenuItemLabelSistemaPiemonte(MenuItem item, int level, boolean isActive) :
	if (level == 1) then
		(isActive ? "<span class=\"menu_alto\">" : "") + "<s:text name=\"" + item.name + ".label\" />" + (isActive ? "</span>" : "")
	//else if (level == 2) then
	//	"<s:text name=\"" + item.name + ".label\" />"
	//else if (level == 3) then
	//	"<s:text name=\"" + item.name + ".label\" />"
	//else if(level == 4) then
	//	"<s:text name=\"" + item.name + ".label\" />"
	else
		"<s:text name=\"" + item.name + ".label\" />";


String getMenuCssSistemaPiemonte(Menu menu, int level, boolean isActive) :
	if (level == 1) then
		"class=\"" + (isActive ? "sottomenuOn" : "sottomenu") + "\""
	else if (level == 2) then
		"class=\"sottomenu\""
	//else if (level == 3) then
	//	"class=\"sottomenu\""
	//else if(level == 4) then
	//	"class=\"sottomenu\""
	else
		"";

String getMenuLinkCssSistemaPiemonte(Menu menu, int level, boolean isActive) :
	if (level == 1) then
		(isActive ? "cssClass=\"attivosottomenu\"" : "")
	//else if (level == 2) then
	//	"cssClass=\"attivosottomenu\""
	//else if (level == 3) then
	//	"cssClass=\"attivosottomenu\""
	//else if(level == 4) then
	//	"cssClass=\"attivosottomenu\""
	else
		"";

String getMenuLabelSistemaPiemonte(Menu menu, int level, boolean isActive) :
	"<s:text name=\"" + menu.name + ".label\" />";


///////////////////////////////////////////////////////////////////////////////////////////////
/// JAVA METHODS BINDING

List getAllPossibleJumps(ContentPanel cp) : JAVA
	it.csi.mddtools.guigen.genutils.GenUtils.getAllPossibleJumps(it.csi.mddtools.guigen.ContentPanel);

List getAllPossibleJumps(MenuItem mi) : JAVA
	it.csi.mddtools.guigen.genutils.GenUtils.getAllPossibleJumps(it.csi.mddtools.guigen.MenuItem);

List getAllPossibleJumps(Menu m) : JAVA
	it.csi.mddtools.guigen.genutils.GenUtils.getAllPossibleJumps(it.csi.mddtools.guigen.Menu);

List getAllPossibleJumps(Command a) : JAVA
	it.csi.mddtools.guigen.genutils.GenUtils.getAllPossibleJumps(it.csi.mddtools.guigen.Command);

List getAllPossibleExtJumps(ContentPanel cp) : JAVA
	it.csi.mddtools.guigen.genutils.GenUtils.getAllPossibleExtJumps(it.csi.mddtools.guigen.ContentPanel);

List getAllPossibleExtJumps(MenuItem mi) : JAVA
	it.csi.mddtools.guigen.genutils.GenUtils.getAllPossibleExtJumps(it.csi.mddtools.guigen.MenuItem);

List getAllPossibleExtJumps(Menu m) : JAVA
	it.csi.mddtools.guigen.genutils.GenUtils.getAllPossibleExtJumps(it.csi.mddtools.guigen.Menu);

List getAllPossibleExtJumps(Command a) : JAVA
	it.csi.mddtools.guigen.genutils.GenUtils.getAllPossibleExtJumps(it.csi.mddtools.guigen.Command);

List getAllEventSourceWidgets(ContentPanel cp) : JAVA
	it.csi.mddtools.guigen.genutils.GenUtils.getAllEventSourceWidgets(it.csi.mddtools.guigen.ContentPanel);
	
List getAllEventSourceMenuItems(Menubar mb) : JAVA
	it.csi.mddtools.guigen.genutils.GenUtils.getAllEventSourceMenuItems(it.csi.mddtools.guigen.Menubar);

List getAllEventSourceMenus(Menubar mb) : JAVA
	it.csi.mddtools.guigen.genutils.GenUtils.getAllEventSourceMenus(it.csi.mddtools.guigen.Menubar);

List getAllExecActionsForEventHandler(EventHandler eh) : JAVA
	it.csi.mddtools.guigen.genutils.GenUtils.getAllExecActionsForEventHandler(it.csi.mddtools.guigen.EventHandler);

List getAllExecActionsRecursive(Command a) : JAVA
	it.csi.mddtools.guigen.genutils.GenUtils.getAllExecActionsRecursive(it.csi.mddtools.guigen.Command);

ContentPanel findParentContentPanel(Command a) : JAVA
	it.csi.mddtools.guigen.genutils.GenUtils.findParentContentPanel(it.csi.mddtools.guigen.Command);

String getFixedRadioButtonList(RadioButtons rb) : JAVA
	it.csi.mddtools.guigen.genutils.GenUtils.getFixedRadioButtonList(it.csi.mddtools.guigen.RadioButtons);

String getFixedRadioButtonList(RadioButton rb) : JAVA
	it.csi.mddtools.guigen.genutils.GenUtils.getFixedRadioButtonList(it.csi.mddtools.guigen.RadioButton);

List findAllActionScopedAppDataInContentPanel(ContentPanel cp) : JAVA
	it.csi.mddtools.guigen.genutils.GenUtils.findAllActionScopedAppDataInContentPanel(it.csi.mddtools.guigen.ContentPanel);

List findAllActionScopedAppDataInMenubar(Menubar mb) : JAVA
	it.csi.mddtools.guigen.genutils.GenUtils.findAllActionScopedAppDataInMenubar(it.csi.mddtools.guigen.Menubar);

List findAllActionScopedAppData(Command a) : JAVA
	it.csi.mddtools.guigen.genutils.GenUtils.findAllActionScopedAppData(it.csi.mddtools.guigen.Command);
			
String getOGNLForWidgetValue(DataWidget w) : JAVA
	it.csi.mddtools.guigen.genutils.GenUtils.getOGNLForWidgetValue(it.csi.mddtools.guigen.DataWidget);

String getOGNLForWidgetMultiValue(MultiDataWidget w) : JAVA
	it.csi.mddtools.guigen.genutils.GenUtils.getOGNLForWidgetMultiValue(it.csi.mddtools.guigen.MultiDataWidget);


// chiave dell'app data quando salvato in sessione
String getAppDataKey(ApplicationData ad) : JAVA
	it.csi.mddtools.guigen.genutils.GenUtils.getAppDataKey(it.csi.mddtools.guigen.ApplicationData);

// nome della property associata all'appdata quando viene inserito nella action
String getAppDataPropertyName(ApplicationData ad) : JAVA
	it.csi.mddtools.guigen.genutils.GenUtils.getAppDataPropertyName(it.csi.mddtools.guigen.ApplicationData);

// [DM] verifica se l'elemento Menu ha un solo Item o no
boolean hasUniqueMenuItem(Menu currMenu) : JAVA
	it.csi.mddtools.guigen.genutils.GenUtils.hasUniqueMenuItem(it.csi.mddtools.guigen.Menu);

List getAllMenuItemRecursive(Menu m) : JAVA
	it.csi.mddtools.guigen.genutils.GenUtils.getAllMenuItemRecursive(it.csi.mddtools.guigen.Menu);


boolean isInMenuBranch(ExecCommand ea) : JAVA
	it.csi.mddtools.guigen.genutils.GenUtils.isInMenuBranch(it.csi.mddtools.guigen.ExecCommand);

// [DM] restituisce il numero di colonne del layout
int getColumnsLayout(FormPanel firstLevPanel, GUIModel model) : JAVA
	it.csi.mddtools.guigen.genutils.GenUtilsLayout.getColumnsLayout(it.csi.mddtools.guigen.FormPanel, it.csi.mddtools.guigen.GUIModel);

// [DM]
Panel getSubPanelByLayout(FormPanel firstLevPanel, UDLRCSpecConstants quadrante) : JAVA
	it.csi.mddtools.guigen.genutils.GenUtilsLayout.getSubPanelByLayout(it.csi.mddtools.guigen.FormPanel, it.csi.mddtools.guigen.UDLRCSpecConstants);

// [DM]
String getGridPanelColumnsNumber(FormPanel p) : JAVA
	it.csi.mddtools.guigen.genutils.GenUtilsLayout.getGridPanelColumnsNumber(it.csi.mddtools.guigen.FormPanel);

// [DM]
List getWidgetsByOrder(FormPanel p)  : JAVA
	it.csi.mddtools.guigen.genutils.GenUtilsLayout.getWidgetsByOrder(it.csi.mddtools.guigen.FormPanel);

// [DM]
String getCustomtagColumnPosition(FormPanel fp, Widget w, Boolean isFirst, Boolean isLast, Boolean isLabel) : JAVA
	it.csi.mddtools.guigen.genutils.GenUtilsLayout.getCustomtagColumnPosition(it.csi.mddtools.guigen.FormPanel, it.csi.mddtools.guigen.Widget, java.lang.Boolean, java.lang.Boolean, java.lang.Boolean);

// [DM]
boolean needHandleCustomtagHeaderHspan(FormPanel fp, Widget w) : JAVA
	it.csi.mddtools.guigen.genutils.GenUtilsLayout.needHandleCustomtagHeaderHspan(it.csi.mddtools.guigen.FormPanel, it.csi.mddtools.guigen.Widget);
	
// [DM]
boolean needHandleCustomtagCloseHspan(FormPanel fp, Widget w) : JAVA
	it.csi.mddtools.guigen.genutils.GenUtilsLayout.needHandleCustomtagCloseHspan(it.csi.mddtools.guigen.FormPanel, it.csi.mddtools.guigen.Widget);

// [DM]
int getCustomtagHeaderColspan(Widget w) : JAVA
	it.csi.mddtools.guigen.genutils.GenUtilsLayout.getCustomtagHeaderColspan(it.csi.mddtools.guigen.Widget);

// [DM]
int getCustomtagHeaderColspan(PlainText w) : JAVA
	it.csi.mddtools.guigen.genutils.GenUtilsLayout.getCustomtagHeaderColspan(it.csi.mddtools.guigen.PlainText);

// [DM]
String getCustomtagCloseColspan(FormPanel fp, Widget w) : JAVA
	it.csi.mddtools.guigen.genutils.GenUtilsLayout.getCustomtagCloseColspan(it.csi.mddtools.guigen.FormPanel, it.csi.mddtools.guigen.Widget);

// [DM]
String getButtonStyleByLayout(GUIModel model, Button b) : JAVA
	it.csi.mddtools.guigen.genutils.GenUtilsLayout.getButtonStyleByLayout(it.csi.mddtools.guigen.GUIModel, it.csi.mddtools.guigen.Button);

// [DM]
String getWidgetLabelFor(Widget w) : JAVA
	it.csi.mddtools.guigen.genutils.GenUtils.getWidgetLabelFor(it.csi.mddtools.guigen.Widget);

// [DM] restituisce le annotazioni per la validazione del campo
String getWidgetValidation(DataWidget w) : JAVA
	it.csi.mddtools.guigen.genutils.GenUtilsStrutsValidation.getWidgetValidation(it.csi.mddtools.guigen.DataWidget);

// [DM] restituisce la lista dei custom validators definiti dal generatore
List getGuigenCustomValidators() : JAVA
	it.csi.mddtools.guigen.genutils.GenUtilsStrutsValidation.getGuigenCustomValidators();

// [DM] restituisce la lista dei custom validators modellati dall'utente nei widget
List getUserCustomValidatorsName() : JAVA
	it.csi.mddtools.guigen.genutils.GenUtilsStrutsValidation.getUserCustomValidatorsName();

// [DM] restituisce (se necessaria) l'annotazione per un Visitor Filed Validator
String getVisitorFieldValidator(ApplicationData ad, Boolean expandVisitorFieldValidator) : JAVA
	it.csi.mddtools.guigen.genutils.GenUtilsStrutsValidation.getVisitorFieldValidator(it.csi.mddtools.guigen.ApplicationData, java.lang.Boolean);

// [DM] verifica se e' necessaria 
boolean isValidatorAnnotationRequired(ComplexType t) : JAVA
	it.csi.mddtools.guigen.genutils.GenUtilsStrutsValidation.isValidatorAnnotationRequired(it.csi.mddtools.guigen.ComplexType);

// [DM] restituisce (se necessaria) l'annotazione di validazione per il field di un DTO
String getValidatorFieldAnnotationForDTO(Field f) : JAVA
	it.csi.mddtools.guigen.genutils.GenUtilsStrutsValidation.getValidatorFieldAnnotationForDTO(it.csi.mddtools.guigen.Field);

// [DM] restituisce la lista delle label del menu
List getMenuBarLabels(Menubar mb) : JAVA
	it.csi.mddtools.guigen.genutils.GenUtilsI18n.getMenuBarLabels(it.csi.mddtools.guigen.Menubar);

// [DM] restituisce la lista delle label dei pannelli di un ContentPanel
List getContentPanelLabels(ContentPanel cp) : JAVA
	it.csi.mddtools.guigen.genutils.GenUtilsI18n.getContentPanelLabels(it.csi.mddtools.guigen.ContentPanel);

// [DM] restituisce la lista delle label dei widgets di un ContentPanel
List getWidgetsLabels(ContentPanel cp) : JAVA
	it.csi.mddtools.guigen.genutils.GenUtilsI18n.getWidgetsLabels(it.csi.mddtools.guigen.ContentPanel);

// [DM] verifica se un ContentPanel contiene o meno delle tabelle (problema della localizzazione della displaytag)
boolean hasTable(ContentPanel cp) : JAVA
	it.csi.mddtools.guigen.genutils.GenUtilsLayout.hasTable(it.csi.mddtools.guigen.ContentPanel);

// [DM] verifica se un Panel contiene o meno delle tabelle (problema della localizzazione della displaytag)
boolean hasTable(Panel p) : JAVA
	it.csi.mddtools.guigen.genutils.GenUtilsLayout.hasTable(it.csi.mddtools.guigen.Panel);

// [DM]
String getText(Widget w) : JAVA
	it.csi.mddtools.guigen.genutils.GenUtilsI18n.getText(it.csi.mddtools.guigen.Widget);

// [DM]
String getComboBoxValueChangedHandlerStyle(GUIModel model) : JAVA
	it.csi.mddtools.guigen.genutils.GenUtilsLayout.getComboBoxValueChangedHandlerStyle(it.csi.mddtools.guigen.GUIModel);



///////////////////////////////////////////////////////////////////////////////////////////////
/// Java Extensions for checks                                                               //
///////////////////////////////////////////////////////////////////////////////////////////////

// [DM] Controlla che tutti i widget di un CommandPanel siano dei CommandWidget.
boolean commandPanelCommandWidgetCheck(CommandPanel cp) : JAVA
	it.csi.mddtools.guigen.genutils.GenUtilsChecks.commandPanelCommandWidgetCheck(it.csi.mddtools.guigen.CommandPanel);

// [DM] Un CommandPanel può avere solo due tipi di layout: [a] HorizontalFlowPanelLayout, [b] UDLRCPanelLayout ristretto (solo LEFT ed RIGHT)
boolean commandPanelLayoutCheck(CommandPanel cp) : JAVA
	it.csi.mddtools.guigen.genutils.GenUtilsChecks.commandPanelLayoutCheck(it.csi.mddtools.guigen.CommandPanel);

// [DM] Controlla che tutti i widget di un MenuPanel siano di tipo MenuView o TreeView.
boolean menuPanelWidgetCheck(MenuPanel mp) : JAVA
	it.csi.mddtools.guigen.genutils.GenUtilsChecks.menuPanelWidgetCheck(it.csi.mddtools.guigen.MenuPanel);



///////////////////////////////////////////////////////////////////////////////////////////////
/// Fake data for widgets (only when needed)                                                 //
/// TODO: remove or comment in PRODUCTION                                                    //
///////////////////////////////////////////////////////////////////////////////////////////////

String getComboboxFakeData() : JAVA
	it.csi.mddtools.guigen.genutils.GenStrutsFakeData.getComboboxFakeData();


